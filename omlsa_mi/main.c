#include"posterfilter\libomlsa_postfilter.h"
#include<string.h>
#include<stdio.h>
#define INLEN   320
#define INLEN41 80


short pcminput[INLEN41];

int Inlen;

short pcmoutput[INLEN41];

int outlen;

int maincnt = 0;


short postertestdata[128] = {

 0xffff,0x30fb,0x5a82,0x7641,0x7fff,0x7641,0x5a83,0x30fb,0x0,0xcf05,0xa57e,0x89c0,0x8001,0x89bf,0xa57f,0xcf05,0x0,0x30fc,0x5a82,0x7641,0x7fff,0x7641,0x5a82,0x30fc,0x0,0xcf04,0xa57e,0x89c0,0x8001,0x89bf,0xa57e,0xcf05,0xffff,0x30fb,0x5a81,0x7641,0x7fff,0x7641,0x5a82,0x30fc,0x0,0xcf05,0xa57e,0x89bf,0x8001,0x89c0,0xa57e,0xcf05,0x0,0x30fc,0x5a82,0x7641,0x7fff,0x7640,0x5a82,0x30fc,0xffff,0xcf05,0xa57f,0x89bf,0x8001,0x89bf,0xa57e,0xcf05,0x0,0x30fc,0x5a82,0x7641,0x7fff,0x7641,0x5a81,0x30fc,0x0,0xcf05,0xa57e,0x89bf,0x8001,0x89bf,0xa57e,0xcf04,0x0,0x30fb,0x5a82,0x7641,0x7fff,0x7641,0x5a82,0x30fb,0x0,0xcf04,0xa57e,0x89bf,0x8001,0x89bf,0xa57e,0xcf05,0xffff,0x30fc,0x5a81,0x7641,0x7fff,0x7640,0x5a81,0x30fb,0x0,0xcf04,0xa57e,0x89c0,0x8001,0x89c0,0xa57e,0xcf05,0xffff,0x30fc,0x5a81,0x7641,0x7fff,0x7640,0x5a81,0x30fb,0x0,0xcf04,0xa57e,0x89c0,0x8001,0x89c0,0xa57e,0xcf05,
};
 
extern float expint(float x);
float val;
void main(){
 
    FILE*fin, *fout;
     char namein[]= {".wav"};
     char nameout[]={"omlsaout_mi.wav"};
     char name[100] = {"../mi/noise6"};  

     char nameo[100];

	 val = expint(0.3318);

     memcpy(nameo,name, sizeof(name));

     strcat(name,namein); 
     fin = fopen(name ,"rb");
    
     strcat(nameo,nameout)  ;
     fout = fopen(nameo,"wb");

	 	 
	 fread(pcminput, 0x2c, 1, fin); 
	 fwrite(pcminput,0x2c,1,fout);

	 PostFilterInit();

     while(feof(fin)==NULL){

	/*	 if(!maincnt) {		 	
			 short tempbuf[512];

			 fread(tempbuf, INLEN*2, 1, fin); 
             PostFilterProcess(tempbuf, INLEN,pcmoutput, &outlen);
		 }
		 else*/{
		     fread(pcminput, INLEN41*2, 1, fin); 

			  memcpy(pcminput,postertestdata, 160);

             PostFilterProcess(pcminput, INLEN41,pcmoutput, &outlen);
		 }

	     fwrite(pcmoutput,INLEN41*2,1,fout);

		 maincnt = 1;
	 }


}