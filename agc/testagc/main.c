#include<string.h>
#include<stdio.h>
#include<stdlib.h>
#include"libWnDigitalAGC.h"


  short vad_data[320] = {
0,
12540, 23169, 30272, 32767, 30272, 23169, 12539, 1, -12539, -23170, -30273, -32767, -30273, -23170, -12539, -1,
12539, 23169, 30273, 32767, 30273, 23170, 12540, 1, -12540, -23170, -30273, -32767, -30274, -23170, -12539, 0,
12539, 23170, 30273, 32767, 30273, 23169, 12539, -1, -12540, -23170, -30273, -32767, -30273, -23170, -12540, 1,
12539, 23170, 30273, 32767, 30273, 23169, 12539, -1, -12540, -23170, -30272, -32766, -30272, -23170, -12539, 0,
12539, 23169, 30274, 32767, 30272, 23170, 12540, 0, -12540, -23170, -30272, -32767, -30272, -23170, -12540, 0,
12540, 23170, 30272, 32767, 30273, 23170, 12539, 0, -12539, -23170, -30273, -32767, -30274, -23170, -12539, -1,
12539, 23169, 30273, 32767, 30273, 23170, 12539, 1, -12539, -23170, -30273, -32767, -30272, -23170, -12539, 0,
12540, 23170, 30272, 32767, 30272, 23170, 12540, -1, -12540, -23170, -30272, -32767, -30273, -23169, -12540, 0,
12539, 23170, 30273, 32767, 30273, 23171, 12539, 0, -12539, -23169, -30273, -32767, -30273, -23170, -12539, 0,
12539, 23171, 30273, 32767, 30273, 23170, 12539, 1, -12539, -23169, -30273, -32767, -30272, -23170, -12540, 0,
12539, 23170, 30273, 32767, 30273, 23169, 12539, 0, -12539, -23169, -30273, -32767, -30273, -23170, -12539, 0,
12539, 23170, 30272, 32767, 30273, 23169, 12539, 0, -12539, -23169, -30273, -32767, -30273, -23170, -12540, 0,
12539, 23169, 30273, 32767, 30273, 23170, 12539, 0, -12539, -23169, -30273, -32767, -30273, -23169, -12539, 0,
12540, 23169, 30272, 32767, 30272, 23170, 12539, 0, -12539, -23170, -30272, -32767, -30272, -23170, -12540, 0,
12539, 23171, 30273, 32767, 30272, 23170, 12539, 0, -12540, -23170, -30272, -32767, -30273, -23170, -12540, 0,
12539, 23170, 30272, 32767, 30273, 23170, 12539, 1, -12540, -23169, -30273, -32767, -30273, -23169, -12540, 0,
12539, 23169, 30273, 32767, 30272, 23170, 12539, 0, -12540, -23170, -30273, -32766, -30272, -23170, -12539, 0,
12539, 23171, 30272, 32767, 30273, 23170, 12539, 0, -12539, -23170, -30273, -32767, -30272, -23170, -12539, 0,
12540, 23170, 30273, 32767, 30273, 23170, 12540, 0, -12540, -23170, -30273, -32767, -30273, -23170, -12539, 1,
12540, 23170, 30273, 32767, 30273, 23170, 12540, 0, -12539, -23169, -30272, -32767, -30272, -23170, -12539,

}
;

int vad, dbval;

  short InputAgc[640];
  int Outlen;
  int Inlen = 160;
 short OutAgc[320];
  int len;
  int audio_frame;
  int frame_size;
  unsigned char EncOutput[160];
  int max_packet;
    unsigned char saturationWarning;
 

	int nRet = 0;
	int nAgcRet;
	short *pData    = NULL;
	short *pOutData = NULL;
	void *agcHandle = NULL;
	 
    int Revagc;
	 
	int frameSize;
  
	void* agcHandle ;


unsigned char wavheader[44];
short pcminput[160];
void main(){

	int i;
	FILE* fin, *fout;

     char namein[]= {".wav"};
     char nameout[]={"_agc.wav"};
	 char name[100]  ={"../voice/agctest01"};// {"../ysy/2018-11-16T09-53-45_10uF,4dBm"};  

     char nameo[100];

     memcpy(nameo,name, sizeof(name));

     strcat(name,namein); 
     fin = fopen(name ,"rb");



	 if(fin==NULL){
		 printf("No such file, check again\n");
		 system("pause");

		 return;
	 }
    
     strcat(nameo,nameout)  ;
     fout = fopen(nameo,"wb");

	 	 
	 fread(pcminput, 0x2c, 1, fin); 
	 fwrite(pcminput,0x2c,1,fout);
		 

	   WnAgcInit(12, 10);
	 //  Revagc = WnAgcProcess((short*)vad_data, 320, OutAgc, &Outlen  ); 
	 
	while(!(feof(fin))){
	
		short InAgc[160];

	fread( InAgc ,256,1,fin);

 

	   //memcpy(Input160, alltab, 320   );
	//nAgcRet = WebRtcAgc_Process(agcHandle, Input160, 0, 320, Outagc,NULL, inMicLevel, &outMicLevel, 0, &saturationWarning);
	 
	 Revagc = WnAgcProcess(InAgc, 128, OutAgc, &Outlen  ); 
	  
	// printf("vad is %d ,  dbval is  %d \n", vad, dbval);
	   
	fwrite(OutAgc,256,1,fout);
	}
	fclose(fout);
}